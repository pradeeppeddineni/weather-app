<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0b0d14">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="description" content="Track min/max temperatures for 14 Indian cities with historical data and 15-day forecasts.">
  <title>Temperature Tracker</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="style.css?v=9">
</head>
<body>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-icon">
      <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
        <circle cx="24" cy="20" r="10" fill="#f97066" opacity="0.8"/>
        <ellipse cx="20" cy="28" rx="14" ry="8" fill="white" opacity="0.9"/>
        <circle cx="12" cy="30" r="6" fill="white" opacity="0.8"/>
        <circle cx="30" cy="29" r="5" fill="white" opacity="0.8"/>
      </svg>
    </div>
    <p class="loading-text">Fetching weather data...</p>
    <div class="loading-bar"><div class="loading-bar-fill" id="loadingBar"></div></div>
  </div>

  <!-- ═══ TAB CONTENT AREA ═══ -->

  <!-- Tab 1: Home (Map View) -->
  <div class="tab-content active" id="tabHome">
    <div class="map-view" id="mapView">
      <div class="map-header">
        <h1 class="map-title">India <span>Weather</span></h1>
        <p class="map-subtitle">Tap a city to explore</p>
        <p class="map-date" id="mapDate"></p>
      </div>
      <div class="map-summary" id="mapSummary"></div>
      <div class="map-container" id="mapContainer">
        <div class="map-glow"></div>
        <svg id="indiaSvg" viewBox="0 0 500 600">
          <defs>
            <radialGradient id="mapFillGrad" cx="50%" cy="45%" r="55%">
              <stop offset="0%" stop-color="rgba(78,168,245,0.15)"/>
              <stop offset="60%" stop-color="rgba(78,168,245,0.05)"/>
              <stop offset="100%" stop-color="rgba(78,168,245,0)"/>
            </radialGradient>
            <filter id="mapGlow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feComposite in="SourceGraphic" in2="blur" operator="over"/>
            </filter>
          </defs>
        </svg>
      </div>
    </div>
  </div>

  <!-- Tab 2: Cities List -->
  <div class="tab-content" id="tabCities">
    <div class="cities-view">
      <div class="cities-header">
        <h1 class="cities-title">Cities</h1>
        <div class="search-box">
          <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input type="text" id="citySearch" placeholder="Search cities..." autocomplete="off">
        </div>
      </div>
      <div class="cities-list" id="citiesList"></div>
      <button class="add-city-btn" id="addCityBtn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add City
      </button>

      <!-- Add City Modal -->
      <div class="add-city-modal" id="addCityModal">
        <div class="add-city-panel">
          <div class="add-city-header">
            <h2>Add City</h2>
            <button class="add-city-close" id="addCityClose">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
          </div>
          <div class="search-box">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            <input type="text" id="addCitySearch" placeholder="Search any city..." autocomplete="off">
          </div>
          <div class="add-city-results" id="addCityResults">
            <p class="add-city-hint">Type a city name to search</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab 3: News -->
  <div class="tab-content" id="tabNews">
    <div class="news-view">
      <div class="news-header">
        <h1 class="news-title">Weather News</h1>
        <p class="news-subtitle">Latest weather updates for India</p>
      </div>
      <div class="news-list" id="newsList">
        <div class="news-loading">
          <div class="news-spinner"></div>
          <p>Loading news...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══ BOTTOM TAB BAR ═══ -->
  <div class="tab-bar" id="tabBar">
    <button class="tab-bar-btn active" data-tab="tabHome">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      <span>Home</span>
    </button>
    <button class="tab-bar-btn" data-tab="tabCities">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
      <span>Cities</span>
    </button>
    <button class="tab-bar-btn" data-tab="tabNews">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2-1v12a2 2 0 0 1-2 2"/>
        <line x1="7" y1="8" x2="13" y2="8"/>
        <line x1="7" y1="12" x2="13" y2="12"/>
        <line x1="7" y1="16" x2="11" y2="16"/>
      </svg>
      <span>News</span>
    </button>
  </div>

  <!-- ═══ DETAIL VIEW (city weather) ═══ -->
  <div class="detail-view" id="detailView">
    <div class="pull-refresh" id="pullRefresh">
      <div class="pull-refresh-spinner"></div>
    </div>
    <div class="detail-topbar">
      <button class="back-btn" id="backBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        <span id="backLabel">Map</span>
      </button>
      <button class="topbar-btn" id="chartBtnDetail" aria-label="Charts">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <rect x="3" y="11" width="3" height="6" rx="1"/>
          <rect x="8.5" y="7" width="3" height="10" rx="1"/>
          <rect x="14" y="3" width="3" height="14" rx="1"/>
        </svg>
      </button>
    </div>

    <h1 class="city-name" id="cityName">Mumbai, <span>India</span></h1>
    <p class="detail-date" id="detailDate"></p>

    <div class="weather-hero">
      <div class="weather-icon-wrap" id="weatherIconWrap"></div>
    </div>

    <div class="temp-display">
      <span class="temp-value" id="tempValue">--</span>
      <span class="temp-degree">°</span>
      <span class="temp-unit">c</span>
    </div>

    <p class="weather-desc" id="weatherDesc">Loading...</p>
    <p class="feels-like" id="feelsLike"></p>

    <div class="stats-row">
      <div class="stat">
        <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/>
        </svg>
        <span id="windSpeed">--</span>
      </div>
      <div class="stat">
        <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
        </svg>
        <span id="humidity">--</span>
      </div>
      <div class="stat">
        <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <span id="sunHours">--</span>
      </div>
      <div class="stat">
        <svg class="stat-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
          <path d="M12 13v4" stroke-linecap="round" opacity="0.5"/>
        </svg>
        <span id="precipProb">--</span>
      </div>
    </div>

    <div class="sun-times" id="sunTimes">
      <div class="sun-time-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round">
          <path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="9" x2="12" y2="2"/>
          <line x1="4.22" y1="10.22" x2="5.64" y2="11.64"/><line x1="1" y1="18" x2="3" y2="18"/>
          <line x1="21" y1="18" x2="23" y2="18"/><line x1="18.36" y1="11.64" x2="19.78" y2="10.22"/>
        </svg>
        <span id="sunriseTime">--</span>
      </div>
      <div class="sun-time-item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f97066" stroke-width="2" stroke-linecap="round">
          <path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="13" x2="12" y2="20"/>
          <line x1="4.22" y1="10.22" x2="5.64" y2="11.64"/><line x1="1" y1="18" x2="3" y2="18"/>
          <line x1="21" y1="18" x2="23" y2="18"/><line x1="18.36" y1="11.64" x2="19.78" y2="10.22"/>
        </svg>
        <span id="sunsetTime">--</span>
      </div>
      <div class="uv-chip" id="uvChip">UV --</div>
      <div class="aqi-chip" id="aqiChip">AQI --</div>
    </div>

    <div class="section-header">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
      </svg>
      <span>Hourly Forecast</span>
    </div>
    <div class="hourly-scroll" id="hourlyScroll"></div>

    <div class="section-header section-header--daily">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      <span>7-Day Forecast</span>
    </div>
    <div class="daily-list" id="dailyList"></div>
  </div>

  <!-- ═══ CHART OVERLAY ═══ -->
  <div class="chart-overlay" id="chartOverlay">
    <div class="chart-overlay-header">
      <button class="chart-back-btn" id="chartClose">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        <span id="chartBackLabel">City</span>
      </button>
      <h2 id="chartTitle">Temperature History</h2>
    </div>

    <!-- Date Range Filters -->
    <div class="chart-filters">
      <div class="chart-filter-row">
        <button class="chart-filter-btn" data-range="3d">3D</button>
        <button class="chart-filter-btn" data-range="7d">7D</button>
        <button class="chart-filter-btn" data-range="1m">1M</button>
        <button class="chart-filter-btn" data-range="3m">3M</button>
        <button class="chart-filter-btn active" data-range="all">All</button>
      </div>
      <div class="chart-filter-row">
        <button class="chart-filter-btn chart-pred-btn" data-pred="historical">Historical</button>
        <button class="chart-filter-btn chart-pred-btn" data-pred="forecast">Forecast</button>
        <button class="chart-filter-btn chart-pred-btn active" data-pred="both">Both</button>
      </div>
    </div>

    <div class="chart-legend">
      <span class="chart-legend-item chart-legend-max"><span class="cll solid"></span> Max</span>
      <span class="chart-legend-item chart-legend-min"><span class="cll solid"></span> Min</span>
      <span class="chart-legend-item"><span class="cll dotted"></span> Forecast</span>
      <span class="chart-legend-item chart-legend-rain"><span class="cll-bar"></span> Rain</span>
    </div>
    <div class="chart-container">
      <canvas id="historyChart"></canvas>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div class="confirm-modal" id="confirmModal">
    <div class="confirm-panel">
      <p>Are you sure?</p>
      <div class="confirm-city-name" id="confirmCityName"></div>
      <div class="confirm-actions">
        <button class="confirm-cancel" id="confirmCancel">Cancel</button>
        <button class="confirm-yes" id="confirmYes">Yes, Remove</button>
      </div>
    </div>
  </div>

  <script src="cities.js?v=9"></script>
  <script src="app.js?v=9"></script>
  <script>
    // Force clear old service worker caches
    if ('caches' in window) {
      caches.keys().then(names => names.forEach(n => {
        if (n !== 'temptrack-v9') caches.delete(n);
      }));
    }
  </script>
</body>
</html>
